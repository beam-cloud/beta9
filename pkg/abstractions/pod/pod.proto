syntax = "proto3";

option go_package = "github.com/beam-cloud/beam/proto";

package pod;

service PodService {
  rpc CreatePod(CreatePodRequest) returns (CreatePodResponse) {}
  rpc SandboxExec(PodSandboxExecRequest) returns (PodSandboxExecResponse) {}
  rpc SandboxStatus(PodSandboxStatusRequest)
      returns (PodSandboxStatusResponse) {}
  rpc SandboxStdout(PodSandboxStdoutRequest)
      returns (PodSandboxStdoutResponse) {}
  rpc SandboxStderr(PodSandboxStderrRequest)
      returns (PodSandboxStderrResponse) {}
  rpc SandboxKill(PodSandboxKillRequest) returns (PodSandboxKillResponse) {}
  rpc SandboxListProcesses(PodSandboxListProcessesRequest)
      returns (PodSandboxListProcessesResponse) {}
  rpc SandboxUploadFile(PodSandboxUploadFileRequest)
      returns (PodSandboxUploadFileResponse) {}
  rpc SandboxDownloadFile(PodSandboxDownloadFileRequest)
      returns (PodSandboxDownloadFileResponse) {}
  rpc SandboxListFiles(PodSandboxListFilesRequest)
      returns (PodSandboxListFilesResponse) {}
  rpc SandboxDeleteFile(PodSandboxDeleteFileRequest)
      returns (PodSandboxDeleteFileResponse) {}
  rpc SandboxCreateDirectory(PodSandboxCreateDirectoryRequest)
      returns (PodSandboxCreateDirectoryResponse) {}
  rpc SandboxDeleteDirectory(PodSandboxDeleteDirectoryRequest)
      returns (PodSandboxDeleteDirectoryResponse) {}
}

message CreatePodRequest { string stub_id = 1; }

message CreatePodResponse {
  bool ok = 1;
  string container_id = 2;
  string error_msg = 3;
}

message PodSandboxExecRequest {
  string container_id = 1;
  string command = 2;
  string cwd = 3;
  map<string, string> env = 4;
}

message PodSandboxExecResponse {
  bool ok = 1;
  string error_msg = 2;
  int32 pid = 3;
}

message PodSandboxStatusRequest {
  string container_id = 1;
  int32 pid = 2;
}

message PodSandboxStatusResponse {
  bool ok = 1;
  string error_msg = 2;
  string status = 3;
  int32 exit_code = 4;
}

message PodSandboxStdoutRequest {
  string container_id = 1;
  int32 pid = 2;
}

message PodSandboxStdoutResponse {
  bool ok = 1;
  string error_msg = 2;
  string stdout = 3;
}

message PodSandboxStderrRequest {
  string container_id = 1;
  int32 pid = 2;
}

message PodSandboxStderrResponse {
  bool ok = 1;
  string error_msg = 2;
  string stderr = 3;
}

message PodSandboxKillRequest {
  string container_id = 1;
  int32 pid = 2;
}

message PodSandboxKillResponse {
  bool ok = 1;
  string error_msg = 2;
}

message PodSandboxListProcessesRequest { string container_id = 1; }

message PodSandboxListProcessesResponse {
  bool ok = 1;
  string error_msg = 2;
  repeated int32 pids = 3;
}

message PodSandboxUploadFileRequest {
  string container_id = 1;
  string container_path = 2;
  int32 mode = 3;
  bytes data = 4;
}

message PodSandboxUploadFileResponse {
  bool ok = 1;
  string error_msg = 2;
}

message PodSandboxDownloadFileRequest {
  string container_id = 1;
  string container_path = 2;
}

message PodSandboxDownloadFileResponse {
  bool ok = 1;
  string error_msg = 2;
  bytes data = 3;
}

message PodSandboxListFilesRequest {
  string container_id = 1;
  string path = 2;
}

message PodSandboxListFilesResponse {
  bool ok = 1;
  string error_msg = 2;
  repeated string files = 3;
}

message PodSandboxDeleteFileRequest {
  string container_id = 1;
  string path = 2;
}

message PodSandboxDeleteFileResponse {
  bool ok = 1;
  string error_msg = 2;
}

message PodSandboxCreateDirectoryRequest {
  string container_id = 1;
  string path = 2;
}

message PodSandboxCreateDirectoryResponse {
  bool ok = 1;
  string error_msg = 2;
}

message PodSandboxDeleteDirectoryRequest {
  string container_id = 1;
  string path = 2;
}

message PodSandboxDeleteDirectoryResponse {
  bool ok = 1;
  string error_msg = 2;
}